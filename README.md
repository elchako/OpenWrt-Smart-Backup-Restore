# OpenWrt Smart Backup & Restore

–£–º–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ OpenWrt —Ä–æ—É—Ç–µ—Ä–∞ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—à–∏–≤–∫–∏ –∏–ª–∏ –ø–µ—Ä–µ–Ω–æ—Å–∞ –Ω–∞ –Ω–æ–≤–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ.

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –°–∫—Ä–∏–ø—Ç –±—ç–∫–∞–ø–∞ (`smart_backup.sh`)
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç:
- ‚úÖ FRP –∫–ª–∏–µ–Ω—Ç —Å –∫–æ–Ω—Ñ–∏–≥–æ–º
- ‚úÖ –í—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏–∑ `/etc/config/`
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏ (—á–µ—Ä–µ–∑ `opkg list-changed-conffiles`)
- ‚úÖ SSH –∫–ª—é—á–∏ (dropbear host keys)
- ‚úÖ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã uHTTPd
- ‚úÖ –ö–ª—é—á–∏ OPKG
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ crontabs
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ sing-box
- ‚úÖ –í–∞–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã (`passwd`, `shadow`, `hosts`, `profile`, –∏ —Ç.–¥.)
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ NFTables
- ‚úÖ –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤

### –°–∫—Ä–∏–ø—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è (`smart_restore.sh`)
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (–≤–∫–ª—é—á–∞—è –∞–≤—Ç–æ—Ñ–∏–∫—Å DNS)
- ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Å–µ –ø–∞–∫–µ—Ç—ã –∏–∑ —Å–ø–∏—Å–∫–∞
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
  - [Podkop](https://github.com/itdoginfo/podkop) - —É–¥–æ–±–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ VPN
  - nano htop
- ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ (–ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫—É –ø–∞–∫–µ—Ç–æ–≤, –Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥–∏)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç - –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞ –Ω–∞ —Ç–µ–∫—É—â–µ–º —Ä–æ—É—Ç–µ—Ä–µ

```bash
# 1. –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Ä–æ—É—Ç–µ—Ä—É –ø–æ SSH
ssh root@192.168.1.1

# 2. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –∫–æ—Ä–µ–Ω—å
cd /root

# 3. –°–∫–∞—á–∏–≤–∞–µ–º —Å–∫—Ä–∏–ø—Ç –±—ç–∫–∞–ø–∞
wget https://github.com/elchako/OpenWrt-Smart-Backup-Restore/raw/refs/heads/main/smart_backup.sh -O smart_backup.sh

# 4. –î–µ–ª–∞–µ–º –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x smart_backup.sh

# 5. –ó–∞–ø—É—Å–∫–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞
./smart_backup.sh
```

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ `/root/backup/` –ø–æ—è–≤—è—Ç—Å—è:
- `openwrt_backup_YYYYMMDD_HHMMSS.tar.gz` - –∞—Ä—Ö–∏–≤ —Å –∫–æ–Ω—Ñ–∏–≥–∞–º–∏
- `installed_packages.txt` - —Å–ø–∏—Å–æ–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤

### –®–∞–≥ 2: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –±—ç–∫–∞–ø–∞

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø–∞–ø–∫—É `/root/backup/` –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä –ª—é–±—ã–º —É–¥–æ–±–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º (SCP, WinSCP, FileZilla –∏ —Ç.–¥.)
–í linux (–∏ –≤–æ–∑–º–æ–∂–Ω–æ windows) –º–æ–∂–Ω–æ —Å –ø–æ–º–æ—â—å—é `scp -O root@192.168.226.1:/root/backup/openwrt_backup_YYYYMMDD_HHMMSS.tar.gz .`

### –®–∞–≥ 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—à–∏–≤–∫–∏

–û–±–Ω–æ–≤–∏—Ç–µ —Ä–æ—É—Ç–µ—Ä –¥–æ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ OpenWrt –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ OpenWrt –Ω–∞ –Ω–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä.

### –®–∞–≥ 4: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–º —Ä–æ—É—Ç–µ—Ä–µ

```bash
# 1. –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Ä–æ—É—Ç–µ—Ä—É –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
ssh root@192.168.1.1

# 2. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –∫–æ—Ä–µ–Ω—å
cd /root
```

–ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø–∞–ø–∫—É `backup` –∏ —Å–∫—Ä–∏–ø—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞ —Ä–æ—É—Ç–µ—Ä –ª—é–±—ã–º —É–¥–æ–±–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º:

**–í–∞—Ä–∏–∞–Ω—Ç –ê: –°–∫–∞—á–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –Ω–∞ —Ä–æ—É—Ç–µ—Ä**
```bash
wget https://github.com/elchako/OpenWrt-Smart-Backup-Restore/raw/refs/heads/main/smart_restore.sh -O smart_restore.sh
```

**–í–∞—Ä–∏–∞–Ω—Ç –ë: –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –≤—Ä—É—á–Ω—É—é**
```bash
nano smart_restore.sh
# –í—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–∫—Ä–∏–ø—Ç–∞ –∏–∑ GitHub
# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏ –≤—ã–π–¥–∏—Ç–µ (:wq –≤ vi –∏–ª–∏ Ctrl+X –≤ nano)
```

### –®–∞–≥ 5: –ó–∞–ø—É—Å–∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

```bash
# 1. –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x smart_restore.sh

# 2. –ó–∞–ø—É—Å–∫–∞–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ (—É–∫–∞–∂–∏—Ç–µ –∏–º—è –≤–∞—à–µ–≥–æ –±—ç–∫–∞–ø–∞)
./smart_restore.sh backup/openwrt_backup_YYYYMMDD_HHMMSS.tar.gz

# –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞–∫–µ—Ç–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –º–æ–¥–µ–º–∞ –∏ internet detector –Ω—É–¥–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç --modem
./smart_restore.sh backup/openwrt_backup_YYYYMMDD_HHMMSS.tar.gz --modem

# –¥–ª—è –ø—Ä–∞–≤–∫–∏ –Ω–æ–º–µ—Ä–∞ —Ä–æ—É—Ç–µ—Ä–∞ –≤ FRPC –¥–æ–±–∞–≤–ª—è–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç --frp (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–º–µ—Å—Ç–µ —Å --modem)
./smart_restore.sh backup/openwrt_backup_YYYYMMDD_HHMMSS.tar.gz --frp

# 3. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ (–Ω–∞–∂–º–∏—Ç–µ Enter)
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç (–≤–∫–ª—é—á–∞—è DNS)
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç –≤—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç –≤—Å–µ –ø–∞–∫–µ—Ç—ã –∏–∑ —Å–ø–∏—Å–∫–∞
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç Podkop
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç —Å–µ—Ä–≤–∏—Å—ã

### –®–∞–≥ 6: –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞

```bash
reboot
```

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Ä–æ—É—Ç–µ—Ä –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!

---

## üìù –í–∞–∂–Ω—ã–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è

### ‚ö†Ô∏è –ï—Å–ª–∏ –Ω–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –Ω–∞ —Ä–æ—É—Ç–µ—Ä–µ

–°–∫—Ä–∏–ø—Ç –≤—Å—ë —Ä–∞–≤–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç –≤—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- ‚ö†Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç —É—Å—Ç–∞–Ω–æ–≤–∫—É –ø–∞–∫–µ—Ç–æ–≤
- ‚ö†Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç Podkop
**–ü–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞** –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ:
```bash
./smart_restore.sh backup/openwrt_backup_YYYYMMDD_HHMMSS.tar.gz
```

### ‚ö†Ô∏è –ü—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å–µ –Ω–∞ –¥—Ä—É–≥—É—é –º–æ–¥–µ–ª—å —Ä–æ—É—Ç–µ—Ä–∞

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–≥—É—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏:
- **WiFi –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** - —Ä–∞–∑–Ω—ã–µ —á–∏–ø—ã –º–æ–≥—É—Ç –∏–º–µ—Ç—å —Ä–∞–∑–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- **–°–µ—Ç–µ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã** - –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ—Ä—Ç–æ–≤ –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ç–∏ –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:
```bash
cat /etc/config/network
cat /etc/config/wireless
```

## üìã –ß—Ç–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|
| –°–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ | `/etc/config/network`, `/etc/config/wireless` |
| Firewall | `/etc/config/firewall`, –ø—Ä–∞–≤–∏–ª–∞ NFTables |
| DHCP/DNS | `/etc/config/dhcp` |
| SSH –∫–ª—é—á–∏ | –°–æ—Ö—Ä–∞–Ω—è–µ—Ç host keys –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è |
| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ | `/etc/passwd`, `/etc/shadow` —Å –ø–∞—Ä–æ–ª—è–º–∏ |
| Cron –∑–∞–¥–∞—á–∏ | –í—Å–µ –∑–∞–¥–∞—á–∏ –∏–∑ `/etc/crontabs/` |
| VPN –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ | sing-box –∏ –¥—Ä—É–≥–∏–µ VPN –∫–ª–∏–µ–Ω—Ç—ã |
| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø–∞–∫–µ—Ç—ã | –í—Å–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `opkg` |
|–ü–∞–∫–µ—Ç –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ FRP —Ç—É–Ω–Ω–µ–ª—è|–¢—É–Ω–Ω–µ–ª—å –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞|

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ, –Ω–∞ —Å–≤–æ–π —Å—Ç—Ä–∞—Ö –∏ —Ä–∏—Å–∫.

## ‚ö†Ô∏è –î–∏—Å–∫–ª–µ–π–º–µ—Ä

–≠—Ç–∏ —Å–∫—Ä–∏–ø—Ç—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è "–∫–∞–∫ –µ—Å—Ç—å". –í—Å–µ–≥–¥–∞ –∏–º–µ–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –≤–∞–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –ê–≤—Ç–æ—Ä –Ω–µ –Ω–µ—Å—ë—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –ø–æ—Ç–µ—Ä—é –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –Ω–µ—Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.

---

**–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏:**
- [Podkop GitHub](https://github.com/itdoginfo/podkop)
- [FRP tunnel –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞](https://github.com/fatedier/frp)
- [Internet detector](https://github.com/gSpotx2f/luci-app-internet-detector)
